"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){function t(e,n){var t=Array.from(document.querySelectorAll(e));return n&&t.forEach(n),t}function l(e,n){return n?t(e,n):document.querySelector(e)||document.createElement("div")}l.all=t;var s={defineProp:function(e,n,t){return Object.defineProperty(e,n,{value:t,configurable:!0,writable:!0,enumerable:!1})},unbind:function(e){e&&e._uav&&(Array.from(e.children).forEach(s.unbind),e._uav.forEach(function(e){return e()}),e._uav=null)},setTag:function(e,n){l.tagRX=new RegExp("(^".concat(e,"|").concat(n,"$)"),"g"),l.expRX=new RegExp("(".concat(e,".*?").concat(n,")"),"g")},stripTags:function(e){return e.replace(l.tagRX,"")},bindStep:function(e,n){return((l.state=Object.create(n)).binding=e)(l.state),l.state=null,n},render:function(e,n,t){return l.node=e.root(),s.defineProp(l.node,"_uav",[]),[{vm:n,ctx:t,el:l.node}].concat(e).reduce(function(e,n){return n(e)}).el}};function p(e,n,t){return Array.prototype[n].apply(e,t)}var e=function(c,f){s.defineProp(c,"fill",function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:c.length;for(l._pause=!0;e<0;)e+=c.length;for(;n<0;)n+=c.length;p(c,"fill",[t,e,n]);for(var r=function(n){c._watch(t,n),c._loops.forEach(function(e){return e.replace(t,n)})},u=0;u<n;u++)r(u);return f(),delete l._pause,c}),s.defineProp(c,"push",function(){for(var e=c.length,n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];p(c,"push",t);for(var u=function(n){c._watch(c[n],n),c._loops.forEach(function(e){return e.add(c[n],n)})},o=e;o<e+t.length;o++)u(o);return f(),c}),s.defineProp(c,"pop",function(){var n=c.length-1;c._loops.forEach(function(e){return e.remove(n)});var e=p(c,"pop");return f(),e}),s.defineProp(c,"reverse",function(){return p(c,"reverse"),f(),c}),s.defineProp(c,"shift",function(){l._pause=!0;var e=p(c,"shift");return c._loops.forEach(function(e){e.hasIndex?(c.forEach(e.replace),e.remove(c.length)):e.remove(0)}),f(),delete l._pause,e}),s.defineProp(c,"sort",function(e){var n=p(c,"sort",[e]);return f(),n}),s.defineProp(c,"splice",function(){for(var e=arguments.length,u=new Array(e),n=0;n<e;n++)u[n]=arguments[n];l._pause=!0;var o=u[0],a=u[1]||0,i=c.length,t=p(c,"splice",u);return c._loops.forEach(function(e){if(e.hasIndex){c.forEach(e.replace);for(var n=i;n>c.length;n--)e.remove(n-1)}else{for(var t=0;t<a;t++)e.remove(o);for(var r=2;r<u.length;r++)e.insert(u[r],o+r-2)}}),c.forEach(c._watch),f(),delete l._pause,t}),s.defineProp(c,"unshift",function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return l._pause=!0,p(c,"unshift",n),c._loops.forEach(function(t){t.hasIndex?c.forEach(t.replace):n.forEach(function(e,n){t.insert(e,n)})}),c.forEach(c._watch),f(),delete l._pause,c})};function o(e){try{return e&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e))}catch(e){return}}function a(e,n){e[n]&&e[n].forEach(function(e){return e.binding(e)})}function d(r){if(!o(r)||r._uav)return r;var u={};return Array.isArray(r)&&(u=[],s.defineProp(u,"_loops",[]),e(u,function(){return a(u._uav,0)})),s.defineProp(u,"_uav",{}),s.defineProp(u,"_watch",function(e,t){r[t]=d(e),Object.defineProperty(u,t,{get:function(){if(l.state&&(!u._loops||"0"===t)){var e=l.state;u._uav[t]=u._uav[t]||[],-1===u._uav[t].indexOf(e)&&u._uav[t].push(e),l.node._uav.push(function(){u._uav[t]&&u._uav[t].splice(u._uav[t].indexOf(e),1),e=null})}return l.last={vm:u,key:t},r[t]},set:function(e){if(r[t]!==e){var n=e&&e._uav;e=d(e),!n&&r[t]&&r[t]._uav&&function n(t,r){t&&t._uav&&o(r)&&(Object.keys(t).forEach(function(e){n(t[e],r[e])}),r._uav=t._uav,t=null)}(r[t],e),r[t]=e,u._loops?l._pause||(u._loops.forEach(function(e){return e.replace(r[t],t)}),a(u._uav,0)):a(u._uav,t)}},configurable:!0,enumerable:!0})}),Object.keys(r).forEach(function(e){return u._watch(r[e],e)}),u}var v=function(r){var u=new Function("with(arguments[0]){with(arguments[1]){return ".concat(r,"}}"));return function(e,n){var t;try{t=u(e,n||{})}catch(e){t="",console.warn(e,r)}return null==t?"":t}},r=function(e,n,t){var r=s.stripTags(e.value).split(" in "),a=v(r[1]),u=r[0].split(","),i=u[0].trim(),c=u[1]?u[1].trim():null,f=y(t.firstElementChild);t.innerHTML="";n.push(function(e){return s.bindStep(function(o){return function(r){Array.from(o.children).forEach(s.unbind),o.innerHTML="";var e=d(a(r.vm,r.ctx)||[]);function u(e,n){var t=r.ctx?Object.create(r.ctx):{};return t[i]=e,t[c]=n,s.render(f,r.vm,t)}l.state=null;var n={hasIndex:c,add:function(e,n){var t=u(e,n);o.appendChild(t)},insert:function(e,n){var t=u(e,n);o.insertBefore(t,o.children[n])},remove:function(e){o.children[e]&&(s.unbind(o.children[e]),o.children[e].remove())},replace:function(e,n){var t=o.children[n],r=u(e,n);t?(s.unbind(t),o.replaceChild(r,t)):o.appendChild(r)}};e._loops.push(n),o._uav.push(function(){e._loops.splice(e._loops.indexOf(n),1)}),e.forEach(n.add)}}(e.el),e)})};function u(e,t){e.push(function(e){return e.el.addEventListener("change",function(){t(e.vm,e.ctx),l.last.vm[l.last.key]=e.el.value,l.last=null}),s.bindStep(function(n){return function(e){n.checked=t(e.vm,e.ctx).toString()===n.value}}(e.el),e),e})}function i(e,r){e.push(function(e){return e.el.addEventListener("input",function(){r(e.vm,e.ctx),l.last.vm[l.last.key]=e.el.value,l.last=null}),s.bindStep(function(t){return function(e){var n=t.selectionStart;t.value=r(e.vm,e.ctx);try{t.setSelectionRange(n,n)}catch(e){}}}(e.el),e),e})}var c=function(e,n,t){var r=v(s.stripTags(e.value));switch(t.getAttribute("type")){case"radio":u(n,r);break;case"checkbox":!function(e,r){function u(t){return function(e){var n=r(e.vm,e.ctx);l.state=null,Array.isArray(n)?t.checked=-1!==n.map(String).indexOf(t.value):t.checked=!!n}}e.push(function(t){t.el.addEventListener("change",function(){var e=r(t.vm,t.ctx);if(Array.isArray(e)){var n=e.indexOf(t.el.value);-1===n&&t.el.checked?e.push(t.el.value):-1===n||t.el.checked||e.splice(n,1)}else l.last.vm[l.last.key]=t.el.checked;return l.last=null,t});var e=r(t.vm,t.ctx);if(Array.isArray(e)){var n=function(){return u(t.el)(t)};e._loops.push({add:n,remove:n,replace:n})}return s.bindStep(u(t.el),t)})}(n,r);break;default:i(n,r)}};function f(e,n){var r=s.stripTags(e.value),u=v(r);n.push(function(e){return s.bindStep(function(t){return function(e){var n=u(e.vm,e.ctx);r&&t.removeAttribute(r),!1!==n&&(r=!0===n?r:n)&&t.setAttribute(r,"")}}(e.el),e)})}function h(e,n){var o=e.value.match(l.expRX),a=o.map(s.stripTags),i=a.map(v),c=e.value,f=e.name.substring(2);n.push(function(e){return s.bindStep(function(u){return function(e){for(var n=c,t=0;t<i.length;t++){var r=i[t](e.vm,e.ctx);switch(_typeof(r)){case"function":return void(u[f]=r);case"boolean":r=r?a[t]:""}n=n.replace(o[t],r)}u.setAttribute(f,n)}}(e.el),e)})}function m(n,e,t){if(0===n.name.indexOf("u-")){switch(n={name:n.name,value:n.value},t.removeAttribute(n.name),n.name){case"u-for":return r(n,e,t);case"u-attr":return f(n,e);case"u-bind":return c(n,e,t)}h(n,e)}else e.push(function(e){return e.el.setAttribute(n.name,n.value),e})}function _(e,n){var u=v(n);e.push(function(e){var n=document.createTextNode("");return e.el.appendChild(n),s.bindStep(function(r){return function(e){var n=u(e.vm,e.ctx);if(n&&(n._el||n.tagName)){var t=n._el?n._el:n;t!==r&&s.unbind(r),r.parentNode&&(r.parentNode.replaceChild(t,r),r=t)}else s.unbind(r),r.textContent=n}}(n),e)})}function y(n){var t=[];return t.root=function(){return n.cloneNode()},Array.from(n.attributes).forEach(function(e){m(e,t,n)}),n.value&&"OPTION"!==n.tagName&&m({name:"value",value:n.value},t,n),Array.from(n.childNodes).forEach(function(e){if(3===e.nodeType)!function(e,t){var n=e.textContent.split(l.expRX);if(1<n.length)n.forEach(function(e){if(e.trim()){var n=document.createTextNode(e);e.match(l.expRX)?_(t,s.stripTags(e)):t.push(function(e){return e.el.appendChild(n.cloneNode()),e})}});else{var r=e.textContent;t.push(function(e){return e.el.appendChild(document.createTextNode(r)),e})}}(e,t);else{var n=y(e);t.push(function(e){return e.el.appendChild(s.render(n,e.vm,e.ctx)),e})}}),t}Array.from||(Array.from=function(e){return e?[].slice.call(e):[]}),s.setTag("{","}"),l.component=function(e,n,t){var r=arguments,u=function(e,n){var t=n?n.cloneNode():document.createElement("div");return t.innerHTML=e,1!==t.children.length&&console.error("Template must have 1 root node:",e),t.firstElementChild}(e.innerHTML||e);if(!n)return u;var o=y(u);(n=d(n))._el=s.render(o,n),t&&("string"==typeof t&&(t=l(t)),t.tagName&&(l.unbind(t.firstElementChild),t.innerHTML="",t.appendChild(n._el)));for(var a=function(e){if("function"==typeof r[e])return setTimeout(function(){return r[e](n._el)}),"break"},i=1;i<arguments.length;i++){if("break"===a(i))break}return n},l.model=d,l.setTag=s.setTag,l.unbind=s.unbind,window.uav=l,"undefined"!=typeof module&&module.exports&&(module.exports=l)}();